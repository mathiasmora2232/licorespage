<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin - Productos</title>
  <link rel="stylesheet" href="admin.css">
</head>
<body>
  <a href="index.html">← Volver al panel</a>
  <h1>Gestionar productos</h1>

  <section>
    <h2>Crear producto</h2>
    <form id="createProductForm">
      <label for="pname">Nombre</label>
      <input id="pname" name="name" required placeholder="Nombre del producto">

      <label for="pprice">Precio</label>
      <input id="pprice" name="price" type="number" step="0.01" required placeholder="0.00">

      <label for="pstock">Stock</label>
      <input id="pstock" name="stock" type="number" required placeholder="Cantidad en inventario">

      <button type="submit">Crear</button>
      <div id="createResult"></div>
    </form>
  </section>

  <section class="mt20">
    <h2>Lista de productos (simulada)</h2>
    <table id="productsTable" border="1" cellpadding="6">
      <thead><tr><th>ID</th><th>Nombre</th><th>Precio</th><th>Stock</th><th>Acciones</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    const products = [];
    const tbody = document.querySelector('#productsTable tbody');

    function render(){
      tbody.innerHTML = '';
      products.forEach((p,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i+1}</td><td>${p.name}</td><td>${p.price}</td><td>${p.stock}</td><td><button data-i="${i}" class="edit">Editar</button> <button data-i="${i}" class="del">Borrar</button></td>`;
        tbody.appendChild(tr);
      });
    }

    document.getElementById('createProductForm').addEventListener('submit', function(e){
      e.preventDefault();
      const p = {
        name: document.getElementById('pname').value,
        price: parseFloat(document.getElementById('pprice').value),
        stock: parseInt(document.getElementById('pstock').value,10)
      };
      products.push(p);
      render();
      document.getElementById('createResult').textContent = 'Producto creado (local, simulado).';
      this.reset();
    });

    tbody.addEventListener('click', function(e){
      if(e.target.matches('.del')){
        const i = e.target.getAttribute('data-i');
        products.splice(i,1);
        render();
      }
      if(e.target.matches('.edit')){
        const i = e.target.getAttribute('data-i');
        const p = products[i];
        const name = prompt('Nombre', p.name);
        if(name!==null) p.name = name;
        render();
      }
    });

    // Nota: reemplaza la lógica local con llamadas fetch a /api/admin/products cuando implementes backend
  </script>
  <script src="admin.js"></script>
  <script>
    (async ()=>{ await checkAdminAuth(); })();
  </script>
</body>
</html>