<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Login - Licores</title>
  <link rel="stylesheet" href="css/nav.css">
  <link rel="stylesheet" href="css/cuenta.css">
  <link rel="stylesheet" href="css/pages.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-brand">
            <div class="nav-logo"> LicoresPage</div>
        </div>
        <ul class="nav-links">
            <li><a href="inicio.html" class="active"> Inicio</a></li>
            <li><a href="productos.html"> Productos</a></li>
            <li><a href="nosotros.html"> Nosotros</a></li>
            <li><a href="contacto.html"> Contacto</a></li>
        </ul>
        <div class="nav-actions">
            <a href="carrito.html" class="nav-icon" id="carrito-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="20" fill="currentColor" class="bi bi-cart-plus" viewBox="0 0 16 16">
 <path d="M9 5.5a.5.5 0 0 0-1 0V7H6.5a.5.5 0 0 0 0 1H8v1.5a.5.5 0 0 0 1 0V8h1.5a.5.5 0 0 0 0-1H9z"/>
 <path d="M.5 1a.5.5 0 0 0 0 1h1.11l.401 1.607 1.498 7.985A.5.5 0 0 0 4 12h1a2 2 0 1 0 0 4 2 2 0 0 0 0-4h7a2 2 0 1 0 0 4 2 2 0 0 0 0-4h1a.5.5 0 0 0 .491-.408l1.5-8A.5.5 0 0 0 14.5 3H2.89l-.405-1.621A.5.5 0 0 0 2 1zm3.915 10L3.102 4h10.796l-1.313 7zM6 14a1 1 0 1 1-2 0 1 1 0 0 1 2 0m7 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0"/>
</svg>
                 <span class="cart-count">0</span>
            </a>
            <a href="cuenta.html" class="nav-icon"> Cuenta</a>
        </div>
    </nav>

  <div class="container">
    <div class="auth-card" role="region" aria-labelledby="loginTitle">
      <h1 id="loginTitle">Mi Cuenta</h1>
      <p>Accede a tu cuenta o crea una nueva</p>

      <div class="auth-tabs">
        <button class="tab-btn active" data-tab="login"> Iniciar SesiÃ³n</button>
        <button class="tab-btn" data-tab="register"> Registrarse</button>
      </div>

      <!-- Formulario de Login -->
      <div id="login-form" class="auth-form active">
        <form id="loginForm" novalidate>
          <div class="form-group">
            <label for="login-email"> Correo ElectrÃ³nico</label>
            <input type="email" id="login-email" name="email" placeholder="tu@email.com" required>
          </div>
          <div class="form-group">
            <label for="login-password"> ContraseÃ±a</label>
            <input type="password" id="login-password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
          </div>
          <div class="form-options">
            <label class="checkbox-container">
              <input type="checkbox" id="remember-me">
              <span class="checkmark"></span>
              Recordarme
            </label>
            <a href="#" class="forgot-password">Â¿Olvidaste tu contraseÃ±a?</a>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" type="submit">INICIAR SESIÃ“N</button>
          </div>
          <div id="loginResult" aria-live="polite"></div>
        </form>
      </div>

      <!-- Formulario de Registro (copiado y adaptado de cuenta.html) -->
      <div id="register-form" class="auth-form">
        <form id="registerForm" novalidate>
          <div class="form-row">
            <div class="form-group">
              <label for="register-name"> Nombre</label>
              <input type="text" id="register-name" placeholder="Tu nombre" required>
            </div>
            <div class="form-group">
              <label for="register-lastname"> Apellido</label>
              <input type="text" id="register-lastname" placeholder="Tu apellido" required>
            </div>
          </div>
          <div class="form-group">
            <label for="register-email"> Correo ElectrÃ³nico</label>
            <input type="email" id="register-email" placeholder="tu@email.com" required>
          </div>
          <div class="form-group">
            <label for="register-phone"> TelÃ©fono</label>
            <input type="tel" id="register-phone" placeholder="+1 234 567 8900">
          </div>
          <div class="form-group">
            <label for="register-password"> ContraseÃ±a</label>
            <input type="password" id="register-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
          </div>
          <div class="form-group">
            <label for="register-confirm"> Confirmar ContraseÃ±a</label>
            <input type="password" id="register-confirm" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
          </div>
          <div class="form-options">
            <label class="checkbox-container">
              <input type="checkbox" id="accept-terms" required>
              <span class="checkmark"></span>
              Acepto los <a href="#">tÃ©rminos y condiciones</a>
            </label>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" type="submit">ðŸŽ‰ Crear Cuenta</button>
          </div>
          <div id="registerResult" aria-live="polite"></div>
        </form>
      </div>

      <p class="admin-link">Â¿Eres administrador? <a href="admin/index.html">Ir al panel admin</a></p>
    </div>
  </div>

  <!-- ConfiguraciÃ³n: si el backend corre en otro puerto, ajusta la base -->
  <script>
    // Cambia esto si tu backend no estÃ¡ en el mismo origen (por ejemplo: http://localhost:8080)
    window.__API_BASE__ = window.__API_BASE__ || 'http://localhost:8080';
  </script>
  <script src="js/authLink.js"></script>
  <!-- El comportamiento del formulario ahora estÃ¡ en TypeScript (compila a dist/login.js) -->
  <script type="module" src="dist/login.js"></script>
  <script>
    // Tabs y lÃ³gica simple de login/registro (intenta el backend, si falla usa fallback demo)
    document.addEventListener('DOMContentLoaded', function(){
      // tabs
      document.querySelectorAll('.tab-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          const tab = btn.getAttribute('data-tab');
          document.querySelectorAll('.auth-form').forEach(f=>f.classList.remove('active'));
          document.getElementById(tab + '-form').classList.add('active');
        });
      });

      const loginForm = document.getElementById('loginForm');
      const loginResult = document.getElementById('loginResult');
      loginForm.addEventListener('submit', async function(e){
        e.preventDefault();
        loginResult.textContent = '';
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;
        const base = window.__API_BASE__ || '';
        try{
          const res = await fetch(`${base}/api/auth/login`, {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
          });
          if(res.ok){
            const data = await res.json();
            if(data.token) localStorage.setItem('authToken', data.token);
            window.location.href = 'cuenta.html';
            return;
          }
        }catch(err){
          // silenciamos y usamos fallback
        }
        // Fallback demo: acepta admin@demo/admin y user@demo/user
        if((email === 'admin@demo' && password === 'admin') || (email === 'user@demo' && password === 'user')){
          localStorage.setItem('authToken', 'demo-'+email);
          window.location.href = 'cuenta.html';
          return;
        }
        loginResult.textContent = 'Credenciales incorrectas o servidor no disponible.';
      });

      const registerForm = document.getElementById('registerForm');
      const registerResult = document.getElementById('registerResult');
      registerForm.addEventListener('submit', function(e){
        e.preventDefault();
        // SimulaciÃ³n: mostramos mensaje y redirigimos al login para iniciar sesiÃ³n
        registerResult.textContent = 'Cuenta creada (simulado). Por favor, inicia sesiÃ³n.';
        setTimeout(()=>{
          document.querySelector('.tab-btn[data-tab="login"]').click();
        }, 900);
      });
    });
  </script>
</body>
</html>